$("input[type=text]").each(function(e,t){t.value.length>0?$(this).siblings("label").addClass("active"):$(this).siblings("label").removeClass("active")});var bar=new ProgressBar.Line(pgr_bar,{strokeWidth:4,easing:"easeInOut",duration:1400,color:"#FFEA82",trailColor:"#eee",trailWidth:1,svgStyle:{width:"100%",height:"100%"}}),theadid=0,bhfs=[],base_url=location.protocol+"//"+location.hostname+":5000/";base_url="http://kepiserver.de:5000/";function percentageToColor(e,t=120,a=0){return e>1&&(e=1),e<0&&(e=0),`hsl(${e*(t-a)+a}, 100%, 40%)`}function timeFromUnix(e){var t=new Date(e);return t.getHours()+":"+("0"+t.getMinutes()).substr(-2)}function display_connection(e,t){for($("#erg").append('<div id="card'+e+'" class="card custom-card rounded-0" style="margin-bottom: 5px">        <h5 class="card-header" role="tab" id="heading'+e+'">          <a class="collapsed d-block text-white rounded-0" data-toggle="collapse" data-parent="#erg" href="#collapse'+e+'" aria-expanded="false" aria-controls="collapse'+e+'">            <table class="table table-sm" id="table'+e+'" style="color: inherit;">              <thead>                <tr>                  <th scope="col" style="width: 25%;">Bahnhof</th>                  <th scope="col" style="width: 10%;">Zeit</th>                  <th scope="col" style="width: 15%;">Dauer</th>                  <th scope="col" style="width: 20%;">Umsteigen</th>                  <th scope="col">Produkte</th>                  <th scope="col">Verbindungs-Score</th>                </tr>              </thead>              <tbody>                <tr>                  <td id="bhf" scope="col">'+$("#startbhf").val()+"<br>"+$("#zielbhf").val()+'</td>                  <td id="time" scope="col">'+timeFromUnix(t[0].departure.scheduledTime)+"<br>"+timeFromUnix(t.slice(-2)[0].arrival.scheduledTime)+'</td>                  <td id="totaltime" scope="col"><b>'+t.slice(-1)[0].totaltime+'</b></td>                  <td id="trans" scope="col"><b>'+t.slice(-1)[0].transfers+'</b></td>                  <td id="prod" scope="col"></td>                  <td id="prob" scope="col"><b>'+t.slice(-1)[0].total_score+'% </b> </td>                </tr>                </tbody>            </table>          </a>        </h5>        <div id="collapse'+e+'" class="collapse" role="tabpanel" aria-labelledby="heading'+e+'">            <div class="card-body" id="details'+e+'">            </div>        </div>    </div>'),$.each(t.slice(-1)[0].segmentTypes,function(t,a){$("#table"+e+" tbody td#prod").append(a+" ")}),str='<ul class="experiences rounded-0">        <table class="details_table">        <tr>          <th>Bahnhof</th>          <th>Uhrzeit</th>          <th>Gleis</th>        </tr>',i=0;i<t.length-1;i++)if("Fußweg"==t[i].train.name){var a=Math.abs(t[i].departure.scheduledTime-t[i].arrival.scheduledTime)/6e4;console.log("data[i]:"),console.log(t[i]),i>0&&i<t.length-2?str=str.concat('<tr>            <td colspan="2" class="transfer"> <img src="'+base_url+'assets/img/fußgänger.svg" height=20px>            davon '+a+" Min. Fußweg</td>          </tr>"):str=str.concat('<tr>            <td colspan="2" class="transfer"> <img src="'+base_url+'assets/img/fußgänger.svg" height=20px>            Fußweg '+a+" Min.</td>          </tr>")}else{var r=t[i].ddelay5,s=t[i].adelay5;if(abcolor=r<.08?"green":r<.25?"orange":"red",ancolor=s<.08?"green":s<.25?"orange":"red",str=str.concat('<tr>          <td> <div class="bhf '+abcolor+'">'+t[i].segmentStart.title+"</div></td>          <td>ab "+timeFromUnix(t[i].departure.scheduledTime)+"</td>          <td> von Gl."+t[i].departure.platform+"</td>        </tr>"),"unknown"!=t[i].train.d_type?str+='<tr>          <td colspan="3"><div class="train"> <img src="'+base_url+"assets/img/"+t[i].train.d_type+'.svg" height=20px>          </img>'+t[i].train.name+"</div></td>        </tr>":str+='<tr>            <td colspan="3"><div class="train">'+t[i].train.name+"</div></td>          </tr>",str=str.concat('<tr>          <td> <div class="bhf '+ancolor+'">'+t[i].segmentDestination.title+"</div></td>          <td>an "+timeFromUnix(t[i].arrival.scheduledTime)+"</td>          <td> an Gl."+t[i].arrival.platform+"</td>        </tr>"),i<t.length-2)if("Fußweg"==t[i+1].train.name&&i!=t.length-3){var l=Math.abs(t[i+2].departure.scheduledTime-t[i].arrival.scheduledTime)/6e4;str+='<tr>            <td colspan="1" class="transfer">Umsteigezeit: '+l+' Min. </td>            <td colspan="2" class="transfer">Verbindungs-Score: '+Math.round(100*t[i].con_score)+"%</td>          </tr>"}else{l=Math.abs(t[i+1].departure.scheduledTime-t[i].arrival.scheduledTime)/6e4;str+='<tr>            <td colspan="1" class="transfer">Umsteigezeit: '+l+' Min. </td>            <td colspan="2" class="transfer">Verbindungs-Score: '+Math.round(100*t[i].con_score)+"%</td>          </tr>"}}str=str.concat("</table>      </ul>"),$("#details"+e).html(str),document.getElementById("card"+e).setAttribute("style","background-color:"+percentageToColor(.02*(t.slice(-1)[0].total_score-50),100,0)+" !important")}function connection(e){console.log("Returned Data:"),console.log(e);for(var t=0;t<e.length;t++)display_connection(t,e[t]);bar.animate(0,{duration:10,easing:"linear"}),$("#pgr_bar").addClass("d-none");var a=$("#erg").offset().top-60;$("HTML, BODY").animate({scrollTop:a},1e3)}function error(e){console.log(e),$("#erg").html('  <div class="alert alert-danger alert-dismissible fade show" role="alert">    <strong>Holy guacamole!</strong> Looks like something went wrong: '+e.status+'<br>    <small>For details see console<small>    <button type="button" class="close" data-dismiss="alert" aria-label="Close">      <span aria-hidden="true">&times;</span>    </button>  </div>'),bar.animate(0,{duration:10,easing:"linear"}),$("#pgr_bar").addClass("d-none")}$("#input").submit(function(){if(document.querySelector("#datetime")._flatpickr.close(),$("#main").removeClass("d-none"),$("#pgr_bar").removeClass("d-none"),$("#about").addClass("d-none"),window.location.hash="",$("#erg").html(""),bhfs.includes($("#startbhf").val())&&bhfs.includes($("#zielbhf").val())){var e=$("#pgr_bar").offset().top-window.innerHeight/2;return $("HTML, BODY").animate({scrollTop:e},1e3),bar.animate(20,{duration:1e4,easing:"linear"}),$.ajax({type:"POST",cache:!1,data:{startbhf:$("#startbhf").val(),zielbhf:$("#zielbhf").val(),date:$("#datetime").val()},url:base_url+"api",dataType:"json",success:function(e){connection(e)},error:function(e){error(e)}}),!1}return bhfs.includes($("#startbhf").val())||$("#startbhf").fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100),bhfs.includes($("#zielbhf").val())||$("#zielbhf").fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100),!1}),$(document).ready(function(){var e=base_url+"connect";$.ajax({type:"POST",cache:!1,data:{keyword:"hi"},url:e,dataType:"json",success:function(e){bhfs=e.bhf,console.log(e),$("#startbhf").autocomplete({lookup:bhfs}),$("#zielbhf").autocomplete({lookup:bhfs})},error:function(e){alert("No Connection to 'kepiserver.de:5000'! \nServer must be down. \nPlease try again later."),console.log(e)}}),$("input[type=text]").each(function(e,t){t.value.length>0?$(this).siblings("label").addClass("active"):$(this).siblings("label").removeClass("active")})}),$("#about_button").click(function(){$("#main").removeClass("d-none"),$("#pgr_bar").addClass("d-none"),$("#about").removeClass("d-none");var e=$("#about").offset().top-window.innerHeight/2;$("HTML, BODY").animate({scrollTop:e},1e3)}),flatpickr("#datetime",{enableTime:!0,time_24hr:!0,dateFormat:"d.m.Y H:i",defaultDate:(new Date).getTime()}),(new WOW).init();