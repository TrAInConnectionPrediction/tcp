!function(t){t.fn.connections=function(o){return"update"===o?a(r,this):"remove"===o?a(n,this):(o=t.extend(!0,{borderClasses:{},class:"connection",css:{},from:this,tag:"connection",to:this,within:":root"},o),e(o),this)},t.event.special.connections={teardown:function(e){a(n,t(this))}};var e=function(e){var n=e.borderClasses,r=e.tag,a=t(e.from),i=t(e.to),c=t(e.within);delete e.borderClasses,delete e.tag,delete e.from,delete e.to,delete e.within,c.each((function(){var t=this,c=new Array;a.each((function(){var a=this;c.push(this),i.not(c).each((function(){o(t,[a,this],r,n,e)}))}))}))},o=function(e,o,n,a,i){var c=t.extend({position:"absolute"},i.css),s=t("<"+n+"/>",i).css(c);s.appendTo(e);var d=(s.outerWidth()-s.innerWidth())/2,h=(s.outerHeight()-s.innerHeight())/2;d<=0&&h<=0&&(d=h=1);var f={borderClasses:a,border_h:h,border_w:d,node_from:t(o[0]),node_to:t(o[1]),nodes_dom:o,css:c};"none"===s.css("border-top-style")&&(f.css.borderStyle="solid"),t.data(s.get(0),"connection",f),t.data(s.get(0),"connections",[s.get(0)]);for(var m=0;m<2;m++){var l=s.add(t.data(o[m],"connections")).get();t.data(o[m],"connections",l),1==l.length&&t(o[m]).on("connections.connections",!1)}r(s.get(0))},n=function(e){for(var o=t.data(e,"connection").nodes_dom,n=0;n<2;n++){var r=t(t.data(o[n],"connections")).not(e).get();t.data(o[n],"connections",r)}t(e).remove()},r=function(e){var o=t.data(e,"connection");if(function(t){t.rect_from=t.nodes_dom[0].getBoundingClientRect(),t.rect_to=t.nodes_dom[1].getBoundingClientRect();var e=t.cache;if(t.cache=[t.rect_from.top,t.rect_from.right,t.rect_from.bottom,t.rect_from.left,t.rect_to.top,t.rect_to.right,t.rect_to.bottom,t.rect_to.left],t.hidden=0==(t.cache[0]|t.cache[1]|t.cache[2]|t.cache[3])||0==(t.cache[4]|t.cache[5]|t.cache[6]|t.cache[7]),t.unmodified=!0,void 0===e)return t.unmodified=!1;for(var o=0;o<8;o++)if(e[o]!==t.cache[o])return t.unmodified=!1}(o),!o.unmodified){var n=o.border_h,r=o.border_w,a=o.rect_from,i=o.rect_to,c=(a.bottom+a.top)/2,s=(i.left+i.right)/2,d=(i.bottom+i.top)/2,h=(a.left+a.right)/2,f=["right","left"];if(h>s){f=["left","right"];var m=Math.max(s-r/2,Math.min(a.right,i.right));s=h+r/2,h=m}else h-=r/2,s=Math.min(s+r/2,Math.max(a.left,i.left));var l=["bottom","top"];if(d>c){l=["top","bottom"];m=Math.max(c-n/2,Math.min(a.bottom,i.bottom));c=d+n/2,d=m}else c=Math.min(c,Math.max(a.top,i.top)),d-=n/2;var u=s-h,b=c-d;u<r&&(d=Math.max(d,Math.min(a.bottom,i.bottom)),c=Math.min(c,Math.max(a.top,i.top)),s=h=((h=Math.max(a.left,i.left))+(s=Math.min(a.right,i.right))-r)/2),b<n&&(h=Math.max(h,Math.min(a.right,i.right)),s=Math.min(s,Math.max(a.left,i.left)),c=d=((d=Math.max(a.top,i.top))+(c=Math.min(a.bottom,i.bottom))-n)/2),(u=s-h)<=0&&(n=0),(b=c-d)<=0&&(r=0);var g="border-"+l[0]+"-"+f[0]+"-radius: 0;border-"+l[0]+"-"+f[1]+"-radius: 0;border-"+l[1]+"-"+f[0]+"-radius: 0;";if((n<=0||r<=0)&&(g+="border-"+l[1]+"-"+f[1]+"-radius: 0;"),o.hidden)g+="display: none;";else{o.css["border-"+l[0]+"-width"]=0,o.css["border-"+f[0]+"-width"]=0,o.css["border-"+l[1]+"-width"]=n,o.css["border-"+f[1]+"-width"]=r;var v=e.getBoundingClientRect();o.css.left=e.offsetLeft+h-v.left,o.css.top=e.offsetTop+d-v.top,o.css.width=u-r,o.css.height=b-n}var p=o.borderClasses;t(e).removeClass(p[l[0]]).removeClass(p[f[0]]).addClass(p[l[1]]).addClass(p[f[1]]).attr("style",g).css(o.css)}},a=function(e,o){return o.each((function(){var o=t.data(this,"connections");if(o instanceof Array)for(var n=0,r=o.length;n<r;n++)e(o[n])}))}}(jQuery);