var theadid=0,bhfs=[],base_url=window.location.href.split("#")[0],position_about=$("#about").offset().top-$("#navbar").innerHeight();flatpickr("#datetime",{enableTime:!0,time_24hr:!0,dateFormat:"d.m.Y H:i",defaultDate:(new Date).getTime()}),$("input[type=text]").each((function(t,e){e.value.length>0?$(this).siblings("label").addClass("active"):$(this).siblings("label").removeClass("active")}));var bar=new ProgressBar.Line(pgr_bar,{strokeWidth:4,easing:"easeInOut",duration:1400,color:"#FFEA82",trailColor:"#eee",trailWidth:1,svgStyle:{width:"100%",height:"100%"}});function percentageToColor(t,e=120,a=0){t>1&&(t=1),t<0&&(t=0);return`hsl(${t*(e-a)+a}, 100%, 40%)`}function timeFromUnix(t){var e=new Date(t);return e.getHours()+":"+("0"+e.getMinutes()).substr(-2)}function display_connection(t,e){for($("#results").append('<div id="card'+t+'" class="card custom-card rounded-0" style="margin-bottom: 5px">        <h5 class="card-header" role="tab" id="heading'+t+'">          <a class="collapsed d-block text-white rounded-0" data-toggle="collapse" data-parent="#results" href="#collapse'+t+'" aria-expanded="false" aria-controls="collapse'+t+'">            <table class="table table-sm" id="table'+t+'" style="color: inherit;">              <thead>                <tr>                  <th scope="col" style="width: 25%;">Bahnhof</th>                  <th scope="col" style="width: 10%;">Zeit</th>                  <th scope="col" style="width: 15%;">Dauer</th>                  <th scope="col" style="width: 20%;">Umsteigen</th>                  <th scope="col">Produkte</th>                  <th scope="col">Verbindungs-Score</th>                </tr>              </thead>              <tbody>                <tr>                  <td id="bhf" scope="col">'+$("#startbhf").val()+"<br>"+$("#zielbhf").val()+'</td>                  <td id="time" scope="col">'+timeFromUnix(e[0].departure.scheduledTime)+"<br>"+timeFromUnix(e.slice(-2)[0].arrival.scheduledTime)+'</td>                  <td id="totaltime" scope="col"><b>'+e.slice(-1)[0].totaltime+'</b></td>                  <td id="trans" scope="col"><b>'+e.slice(-1)[0].transfers+'</b></td>                  <td id="prod" scope="col"></td>                  <td id="prob" scope="col"><b>'+e.slice(-1)[0].total_score+'% </b> </td>                </tr>                </tbody>            </table>          </a>        </h5>        <div id="collapse'+t+'" class="collapse" role="tabpanel" aria-labelledby="heading'+t+'">            <div class="card-body" id="details'+t+'">            </div>        </div>    </div>'),$.each(e.slice(-1)[0].segmentTypes,(function(e,a){$("#table"+t+" tbody td#prod").append(a+" ")})),str='<ul class="experiences rounded-0">        <table class="details_table">        <tr>          <th>Bahnhof</th>          <th>Uhrzeit</th>          <th>Gleis</th>        </tr>',i=0;i<e.length-1;i++)if("Fußweg"==e[i].train.name){var a=Math.abs(e[i].departure.scheduledTime-e[i].arrival.scheduledTime)/6e4;console.log("data[i]:"),console.log(e[i]),i>0&&i<e.length-2?str=str.concat('<tr>            <td colspan="2" class="transfer"> <img src="'+base_url+'assets/img/pedestrian.svg" height=20px>            davon '+a+" Min. Fußweg</td>          </tr>"):str=str.concat('<tr>            <td colspan="2" class="transfer"> <img src="'+base_url+'assets/img/pedestrian.svg" height=20px>            Fußweg '+a+" Min.</td>          </tr>")}else{var s=e[i].ddelay5,r=e[i].adelay5;if(abcolor=s<.08?"green":s<.25?"orange":"red",ancolor=r<.08?"green":r<.25?"orange":"red",str=str.concat('<tr>          <td> <div class="bhf '+abcolor+'">'+e[i].segmentStart.title+"</div></td>          <td>ab "+timeFromUnix(e[i].departure.scheduledTime)+"</td>          <td> von Gl."+e[i].departure.platform+"</td>        </tr>"),"unknown"!=e[i].train.d_type?str+='<tr>          <td colspan="3"><div class="train"> <img src="'+base_url+"assets/img/"+e[i].train.d_type+'.svg" height=20px>          </img>'+e[i].train.name+"</div></td>        </tr>":str+='<tr>            <td colspan="3"><div class="train">'+e[i].train.name+"</div></td>          </tr>",str=str.concat('<tr>          <td> <div class="bhf '+ancolor+'">'+e[i].segmentDestination.title+"</div></td>          <td>an "+timeFromUnix(e[i].arrival.scheduledTime)+"</td>          <td> an Gl."+e[i].arrival.platform+"</td>        </tr>"),i<e.length-2)if("Fußweg"==e[i+1].train.name&&i!=e.length-3){var l=Math.abs(e[i+2].departure.scheduledTime-e[i].arrival.scheduledTime)/6e4;str+='<tr>            <td colspan="1" class="transfer">Umsteigezeit: '+l+' Min. </td>            <td colspan="2" class="transfer">Verbindungs-Score: '+Math.round(100*e[i].con_score)+"%</td>          </tr>"}else{l=Math.abs(e[i+1].departure.scheduledTime-e[i].arrival.scheduledTime)/6e4;str+='<tr>            <td colspan="1" class="transfer">Umsteigezeit: '+l+' Min. </td>            <td colspan="2" class="transfer">Verbindungs-Score: '+Math.round(100*e[i].con_score)+"%</td>          </tr>"}}str=str.concat("</table>      </ul>"),$("#details"+t).html(str),document.getElementById("card"+t).setAttribute("style","background-color:"+percentageToColor(.02*(e.slice(-1)[0].total_score-50),100,0)+" !important")}function connection(t){console.log("Returned Data:"),console.log(t);for(var e=0;e<t.length;e++)display_connection(e,t[e]);bar.animate(0,{duration:10,easing:"linear"}),showSection("results");var a=$("#results").offset().top-60;$("HTML, BODY").animate({scrollTop:a},1e3)}function con_error(t){alert("No Connection to "+base_url+"! \nServer must be down. \nPlease try again later."),console.log(jqXHR)}function error(t){console.log(t),$("#results").html('  <div class="alert alert-danger alert-dismissible fade show" role="alert">    <strong>Holy guacamole!</strong> Looks like something went wrong: '+t.status+'<br>    <small>For details see console<small>    <button type="button" class="close" data-dismiss="alert" aria-label="Close">      <span aria-hidden="true">&times;</span>    </button>  </div>'),bar.animate(0,{duration:10,easing:"linear"}),showSection("results")}$("#input").submit((function(){if(document.querySelector("#datetime")._flatpickr.close(),showSection("pgr_bar"),window.location.hash="",$("#results").html(""),bhfs.includes($("#startbhf").val())&&bhfs.includes($("#zielbhf").val())){var t=$("#pgr_bar").offset().top-window.innerHeight/2;return $("HTML, BODY").animate({scrollTop:t},1e3),bar.animate(60,{duration:3e4,easing:"linear"}),$.ajax({type:"POST",cache:!1,data:{startbhf:$("#startbhf").val(),zielbhf:$("#zielbhf").val(),date:$("#datetime").val()},url:base_url+"api/trip",dataType:"json",success:function(t){connection(t)},error:function(t){error(t)}}),!1}return bhfs.includes($("#startbhf").val())||$("#startbhf").fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100),bhfs.includes($("#zielbhf").val())||$("#zielbhf").fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100),!1})),$(document).ready((function(){var t=$(window).width()+"x"+$(window).height(),e="0.0.0.0";$.ajax({type:"GET",cache:!1,async:!1,url:"https://www.cloudflare.com/cdn-cgi/trace",success:function(t){e=t.match(/[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}/)[0]},error:function(){return!0}}),$.ajax({type:"POST",cache:!1,data:{screen:t,ip:e},url:base_url+"api/connect",dataType:"json",success:function(t){bhfs=t.bhf,$("#startbhf").autocomplete({lookup:bhfs}),$("#zielbhf").autocomplete({lookup:bhfs})},error:function(t){con_error(t)}}),$("input[type=text]").each((function(t,e){e.value.length>0?$(this).siblings("label").addClass("active"):$(this).siblings("label").removeClass("active")})),$("#nav_buttons").children().each((function(){location.hash+"_button"=="#"+this.id&&$(this).click()}))}));