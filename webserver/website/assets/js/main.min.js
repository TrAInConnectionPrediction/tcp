var theadid=0,bhfs=[],base_url=window.location.href.split("#")[0],position_about=$("#about").offset().top-$("#navbar").innerHeight();flatpickr("#datetime",{enableTime:!0,time_24hr:!0,dateFormat:"d.m.Y H:i",defaultDate:(new Date).getTime()}),$("input[type=text]").each((function(e,a){a.value.length>0?$(this).siblings("label").addClass("active"):$(this).siblings("label").removeClass("active")}));var bar=new ProgressBar.Line(pgr_bar,{strokeWidth:4,easing:"easeInOut",duration:1400,color:"#FFEA82",trailColor:"#eee",trailWidth:1,svgStyle:{width:"100%",height:"100%"}});function rdylgr_colormap(e,a=0,t=1,n=255){return e=(e-a)/(t-a),(e=Math.max(0,Math.min(e,1)))>.5?`rgb(${Math.round(Math.sqrt(n*n*2*(1-e)))}, ${n}, 0)`:`rgb(${n}, ${Math.round(Math.sqrt(n*n*2*e))}, 0)`}Vue.mixin({delimiters:["[[","]]"]}),Vue.component("connection",{props:["summary","segments","con_score"],data:function(){return{show_details:!1,background_color:{"background-color":rdylgr_colormap(this.con_score,min=50,max=100)}}},template:"\n\x3c!-- summary --\x3e\n<div v-bind:style='background_color' class='custom_card'>\n    <div v-on:click=\"show_details = !show_details\" class='card_header'>\n    <div class='card_header_item'>\n        <div class='card_header_item_header'> Bahnhof </div>\n        <div class='card_header_item_item'> [[ summary.dp_station ]] </div>\n        <div class='card_header_item_item'> [[ summary.ar_station ]] </div>\n    </div>\n    <div class='card_header_item'>\n        <div class='card_header_item_header'> Zeit </div>\n        <div class='card_header_item_item'> [[ summary.dp_pt ]] </div>\n        <div class='card_header_item_item'> [[ summary.ar_pt ]] </div>\n    </div>\n    <div class='card_header_item'>\n        <div class='card_header_item_header'> Dauer </div>\n        <div class='card_header_item_item'> [[ summary.duration ]] </div>\n    </div>\n    <div class='card_header_item'>\n        <div class='card_header_item_header'> Umstiege </div>\n        <div class='card_header_item_item'> [[ summary.transfers ]] </div>\n    </div>\n    <div class='card_header_item'>\n        <div class='card_header_item_header'> Produkte </div>\n        <div v-for='cat in summary.train_categories' class='card_header_item_item'>[[ cat ]] </div>\n    </div>\n    <div class='card_header_item'>\n        <div class='card_header_item_header'> Verbindungs-Score </div>\n        <div class='card_header_item_item'> [[ summary.score ]]% </div>\n    </div>\n        \n    </div>\n    \x3c!-- segments --\x3e\n    <transition name=\"open\">\n    <div v-if='show_details' class='card_contents'>\n    <div>\n        <div class=\"details_grid\">\n            <segment v-for='(segment, index) in segments' v-bind:key='index'\n            v-bind:segment='segment' v-bind:con_score='con_score'></segment>\n        </div>\n    </div>\n    </div>\n    </transition>\n</div>\n"}),Vue.component("segment",{props:["segment","con_score"],data:function(){return{show_details:!1,base_url:base_url,dp_station_style:{"background-color":rdylgr_colormap(this.segment.dp_delay,min=.2,max=.8)},ar_station_style:{"background-color":rdylgr_colormap(this.segment.ar_delay,min=.2,max=.8)},transfer_style:{"background-color":rdylgr_colormap(this.con_score,min=50,max=100),"border-color":rdylgr_colormap(this.con_score,min=50,max=100)},train_icons:["ICE","IC","RE","S","RB"]}},template:"\n<div style='display: contents'>\n    <div class=\"station\" v-bind:style=\"dp_station_style\">[[ segment.dp_station ]]</div>\n    <div class='time'>ab [[ segment.dp_pt ]]</div>\n    <div class='platform'> von Gl. [[ segment.dp_pp ]]</div>\n\n    <div class=\"train\" style=\"grid-column-start: span 3;\">\n    <img v-if='train_icons.includes(segment.dp_c)' v-bind:src=\"'assets/img/' + segment.dp_c + '.svg'\" height=20px></img>\n        [[ segment.train_name ]] nach [[ segment.train_destination ]]\n    </div>\n\n    <div class=\"station\"  v-bind:style=\"ar_station_style\">[[ segment.ar_station ]]</div>\n    <div class='time'>an [[ segment.ar_pt ]]</div>\n    <div class='platform'> an Gl. [[ segment.ar_pp ]]</div>\n\n    <div v-if='\"transfer_time\" in segment' style='display: contents'>\n        <div class=\"transfer\" v-bind:style='transfer_style'>Umsteigezeit: [[ segment.transfer_time ]] Min.</div>\n        <div class=\"score\" v-bind:style='transfer_style'>Verbindungs-Score: [[ segment.score ]]%</div>\n    </div>\n\n    <div v-if='segment.walk' class=\"walk\" v-bind:style='transfer_style'>\n        <img src=\"assets/img/pedestrian.svg\" height=20px></img>\n        davon [[ segment.walk ]] Min. Fu√üweg\n    </div>\n</div>\n"});var connection_display=new Vue({el:"#results",delimiters:["[[","]]"],data:{connections:[]}});function connection(e){console.log("Returned Data:"),console.log(e);for(var a=0;a<e.length;a++)display_connection(a,e[a]);bar.animate(0,{duration:10,easing:"linear"}),showSection("results");var t=$("#results").offset().top-60;$("HTML, BODY").animate({scrollTop:t},1e3)}function con_error(e){alert("No Connection to "+base_url+"! \nServer must be down. \nPlease try again later."),console.log(jqXHR)}function error(e){console.log(e),$("#results").html('  <div class="alert alert-danger alert-dismissible fade show" role="alert">    <strong>Holy guacamole!</strong> Looks like something went wrong: '+e.status+'<br>    <small>For details see console<small>    <button type="button" class="close" data-dismiss="alert" aria-label="Close">      <span aria-hidden="true">&times;</span>    </button>  </div>'),bar.animate(0,{duration:10,easing:"linear"}),showSection("results")}$("#input").submit((function(){if(document.querySelector("#datetime")._flatpickr.close(),showSection("pgr_bar"),window.location.hash="",bhfs.includes($("#startbhf").val())&&bhfs.includes($("#zielbhf").val())){connection_display.connections=[];var e=$("#pgr_bar").offset().top-window.innerHeight/2;return $("HTML, BODY").animate({scrollTop:e},1e3),bar.animate(60,{duration:3e4,easing:"linear"}),$.ajax({type:"POST",cache:!1,data:{startbhf:$("#startbhf").val(),zielbhf:$("#zielbhf").val(),date:$("#datetime").val()},url:base_url+"api/trip",dataType:"json",success:function(e){bar.animate(0,{duration:10,easing:"linear"}),showSection("results");var a=$("#results").offset().top-60;$("HTML, BODY").animate({scrollTop:a},1e3),connection_display.connections=e},error:function(e){error(e)}}),!1}return bhfs.includes($("#startbhf").val())||$("#startbhf").fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100),bhfs.includes($("#zielbhf").val())||$("#zielbhf").fadeOut(100).fadeIn(100).fadeOut(100).fadeIn(100),!1})),$(document).ready((function(){$.ajax({type:"POST",cache:!1,data:{},url:base_url+"api/connect",dataType:"json",success:function(e){bhfs=e.bhf,$("#startbhf").autocomplete({lookup:bhfs}),$("#zielbhf").autocomplete({lookup:bhfs})},error:function(e){con_error(e)}}),$("input[type=text]").each((function(e,a){a.value.length>0?$(this).siblings("label").addClass("active"):$(this).siblings("label").removeClass("active")})),$("#nav_buttons").children().each((function(){location.hash+"_button"=="#"+this.id&&$(this).click()}))}));